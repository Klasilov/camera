<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÁå™Áõ∏Êú∫ (Piggy Camera)</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Lucide Icons (Development version for browser) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Smiley Sans (using Noto Sans SC as fallback/proxy if Smiley not available, 
         but trying to use a font that looks close or importing a specific one if possible. 
         Since Smiley Sans is a specific Chinese font, we'll try to import it or use a cursive fallback) -->
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        /* Custom Font Setup */
        @font-face {
            font-family: 'Smiley Sans';
            src: url('https://cdn.jsdelivr.net/gh/atelier-anchor/smiley-sans@v2.0.1/fonts/SmileySans-Oblique.ttf') format('truetype');
            font-display: swap;
        }

        body {
            font-family: 'Smiley Sans', 'Ma Shan Zheng', cursive, sans-serif;
            background-color: #f3f4f6;
            overflow: hidden;
            /* Prevent scrolling */
            user-select: none;
        }

        /* Custom Scrollbar for any scrolling elements if needed */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        /* Leather Texture Pattern */
        .leather-texture {
            background-color: #1a1a1a;
            background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23262626' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
        }

        /* Metal Texture */
        .metal-texture {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 50%, #94a3b8 100%);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        /* Lens Reflection */
        .lens-reflection {
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 20%),
                radial-gradient(circle at 70% 70%, rgba(100, 100, 255, 0.1) 0%, rgba(100, 100, 255, 0) 20%);
        }
    </style>
</head>

<body class="h-screen w-screen overflow-hidden bg-stone-100 relative">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        const { motion, AnimatePresence } = window.Motion;

        // --- Icons ---
        // Simple SVG components since we can't easily use lucide-react imports in standalone babel
        const CameraIcon = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" /><circle cx="12" cy="13" r="3" /></svg>
        );
        const DownloadIcon = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg>
        );
        const TrashIcon = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></svg>
        );
        const RefreshCwIcon = ({ size = 16, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></svg>
        );
        const EditIcon = ({ size = 16, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></svg>
        );

        // --- Utils ---
        const playShutterSound = () => {
            const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.m4a'); // Simple camera shutter sound
            audio.volume = 0.5;
            audio.play().catch(e => console.log("Audio play failed", e));
        };

        const generateCaption = () => {
            const captions = [
                "‰ªäÂ§©‰πüÊòØÂÖÉÊ∞îÊª°Êª°ÁöÑÂ∞èÁå™ÔºÅ",
                "ÂèØÁà±ÂÄºÁàÜË°®Âï¶~",
                "ÂìºÂìº~ ÂèëÁé∞‰∏ÄÂè™Â∞èÂèØÁà±ÔºÅ",
                "ËøôÊòØË∞ÅÂÆ∂ÁöÑÂ∞èÁå™Áå™ÂëÄÔºü",
                "ÊçïÊçâÂà∞‰ªäÊó•‰ªΩÁöÑÂø´‰πêÔºÅ",
                "Smile! üê∑",
                "Â∞èÁå™Áå™ÁöÑÂ•áÂ¶ôÂÜíÈô©~",
                "‰ªäÊó•ËøêÂäøÔºöË∂ÖÁ∫ßÂèØÁà±ÔºÅ"
            ];
            return captions[Math.floor(Math.random() * captions.length)];
        };

        const formatDate = () => {
            const now = new Date();
            return `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
        };

        // --- Components ---

        const PhotoCard = ({ id, imageSrc, initialX, initialY, onDelete }) => {
            const [caption, setCaption] = useState(generateCaption());
            const cardRef = useRef(null);

            const handleDownload = async (e) => {
                e.stopPropagation(); // Prevent drag start
                if (cardRef.current) {
                    try {
                        const canvas = await html2canvas(cardRef.current, {
                            backgroundColor: null,
                            scale: 2 // Higher resolution
                        });
                        const link = document.createElement('a');
                        link.download = `piggy-photo-${Date.now()}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                    } catch (err) {
                        console.error("Download failed", err);
                    }
                }
            };

            const handleDelete = (e) => {
                e.stopPropagation();
                onDelete(id);
            };

            const refreshCaption = (e) => {
                e.stopPropagation();
                setCaption(generateCaption());
            };

            return (
                <motion.div
                    drag
                    dragMomentum={false}
                    initial={{ x: initialX, y: initialY, scale: 0.8, opacity: 0 }}
                    animate={{ scale: 1, opacity: 1 }}
                    exit={{ scale: 0.5, opacity: 0 }}
                    className="absolute z-10 cursor-grab active:cursor-grabbing group"
                    style={{ touchAction: 'none' }}
                >
                    <div
                        ref={cardRef}
                        className="bg-white p-4 pb-2 shadow-xl transform rotate-1 hover:rotate-0 transition-transform duration-300 relative w-[320px]"
                    >
                        {/* Piggy Ring Decoration */}
                        <div className="absolute inset-0 pointer-events-none border-[12px] border-transparent border-image-slice-1"
                            style={{
                                borderImageSource: `url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='50%25' y='50%25' font-size='20' text-anchor='middle' dy='.3em'%3Eüê∑%3C/text%3E%3C/svg%3E")`,
                                borderImageSlice: 30,
                                borderImageRepeat: 'round',
                                opacity: 0.3
                            }}
                        />

                        {/* Header */}
                        <div className="text-center mb-2">
                            <h3 className="text-xl font-bold text-pink-500 tracking-widest">Â∞èÁå™ÁÖßÁâá</h3>
                        </div>

                        {/* Photo */}
                        <div className="aspect-[4/3] bg-gray-100 overflow-hidden border-2 border-gray-100">
                            <img src={imageSrc} alt="Captured" className="w-full h-full object-cover" draggable={false} />
                        </div>

                        {/* Footer / Caption */}
                        <div className="mt-3 flex flex-col items-center justify-center text-gray-600 min-h-[60px]">
                            <p className="text-sm font-medium text-center px-2 relative group/caption">
                                {caption}
                                <button
                                    onClick={refreshCaption}
                                    className="ml-2 inline-block opacity-0 group-hover/caption:opacity-100 transition-opacity hover:text-pink-500"
                                >
                                    <RefreshCwIcon size={12} />
                                </button>
                            </p>
                            <p className="text-xs text-gray-400 mt-1 font-mono">{formatDate()}</p>
                        </div>

                        {/* Hover Controls (Not part of download) */}
                        <div
                            className="absolute -top-3 -right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                            data-html2canvas-ignore
                        >
                            <button
                                onClick={handleDownload}
                                className="bg-blue-500 text-white p-2 rounded-full shadow-lg hover:bg-blue-600 transition-colors"
                                title="Download"
                            >
                                <DownloadIcon size={16} />
                            </button>
                            <button
                                onClick={handleDelete}
                                className="bg-red-500 text-white p-2 rounded-full shadow-lg hover:bg-red-600 transition-colors"
                                title="Delete"
                            >
                                <TrashIcon size={16} />
                            </button>
                        </div>
                    </div>
                </motion.div>
            );
        };

        const CameraBody = ({ videoRef, onShutter }) => {
            return (
                <div className="fixed bottom-16 left-16 w-[500px] h-[360px] z-20 select-none">
                    {/* Main Body Shape */}
                    <div className="absolute inset-0 bg-[#e5e5e5] rounded-[40px] shadow-2xl flex flex-col overflow-hidden border-b-8 border-[#d4d4d4]">

                        {/* Top Metal Plate */}
                        <div className="h-24 metal-texture w-full border-b border-gray-400 relative flex items-center justify-between px-8">
                            {/* Brand Name */}
                            <div className="text-2xl font-bold text-gray-700 tracking-widest italic">
                                FUJIPIG
                            </div>

                            {/* Viewfinder Bump */}
                            <div className="absolute left-1/2 top-0 -translate-x-1/2 w-32 h-12 bg-[#cbd5e1] rounded-b-xl shadow-inner border-b border-gray-400 flex items-center justify-center">
                                <div className="w-20 h-6 bg-black rounded-full opacity-80"></div>
                            </div>

                            {/* Shutter Button Area */}
                            <div className="relative">
                                <button
                                    onClick={onShutter}
                                    className="w-14 h-14 rounded-full bg-gradient-to-b from-gray-200 to-gray-400 shadow-[0_4px_0_#94a3b8] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center border-2 border-gray-300 group"
                                >
                                    <div className="w-10 h-10 rounded-full bg-red-500 shadow-inner group-active:bg-red-600"></div>
                                </button>
                            </div>
                        </div>

                        {/* Leather Body */}
                        <div className="flex-1 leather-texture relative flex">
                            {/* Grip */}
                            <div className="absolute right-4 top-8 w-12 h-48 bg-[#262626] rounded-l-2xl shadow-lg opacity-80"></div>

                            {/* Lens Mount (Decorative) */}
                            <div className="absolute left-12 top-1/2 -translate-y-1/2 w-48 h-48 rounded-full bg-[#262626] shadow-2xl border-4 border-[#404040] flex items-center justify-center">
                                {/* Inner Lens Rings */}
                                <div className="w-40 h-40 rounded-full bg-[#171717] border-2 border-gray-600 flex items-center justify-center">
                                    <div className="w-32 h-32 rounded-full bg-[#0a0a0a] border border-gray-700 flex items-center justify-center lens-reflection relative overflow-hidden">
                                        <div className="absolute inset-0 bg-gradient-to-tr from-purple-900/20 to-blue-900/20"></div>
                                        <div className="text-xs text-gray-500 font-mono tracking-tighter mt-16">
                                            PIGGY LENS 35mm 1:1.4
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Flip Screen (The actual Viewfinder) */}
                            <div className="absolute left-[280px] top-8 w-[180px] h-[140px] bg-black rounded-lg border-4 border-[#404040] shadow-lg overflow-hidden origin-left transform -rotate-y-12 perspective-1000">
                                <div className="w-full h-full bg-gray-900 relative">
                                    <video
                                        ref={videoRef}
                                        autoPlay
                                        playsInline
                                        muted
                                        className="w-full h-full object-cover transform scale-x-[-1]" // Mirror effect
                                    />
                                    {/* Screen UI Overlay */}
                                    <div className="absolute inset-0 pointer-events-none p-2 flex flex-col justify-between text-[10px] text-green-400 font-mono opacity-80">
                                        <div className="flex justify-between">
                                            <span>REC</span>
                                            <span>[ 1600 ]</span>
                                        </div>
                                        <div className="flex justify-center">
                                            <div className="w-4 h-4 border border-green-400/50"></div>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>ISO 400</span>
                                            <span>1/125</span>
                                        </div>
                                    </div>
                                </div>
                                {/* Hinge */}
                                <div className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-full w-4 h-20 bg-[#404040] rounded-l-md"></div>
                            </div>

                            {/* Bottom Text */}
                            <div className="absolute bottom-4 right-8 text-gray-500 font-mono text-xs opacity-50">
                                PIG-X100V
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const videoRef = useRef(null);
            const [photos, setPhotos] = useState([]);
            const [toast, setToast] = useState(null);

            // Initialize Camera
            useEffect(() => {
                const startCamera = async () => {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: { width: 1280, height: 720 }
                        });
                        if (videoRef.current) {
                            videoRef.current.srcObject = stream;
                        }
                    } catch (err) {
                        console.error("Error accessing camera:", err);
                        alert("Êó†Ê≥ïËÆøÈóÆÊëÑÂÉèÂ§¥ÔºåËØ∑Á°Æ‰øùÂ∑≤Êéà‰∫àÊùÉÈôê„ÄÇ");
                    }
                };
                startCamera();
            }, []);

            const handleShutter = () => {
                if (!videoRef.current) return;

                playShutterSound();

                // Show Toast
                setToast("Â∑≤ÊçïËé∑Â∞èÁå™ÁÖßÁâá");
                setTimeout(() => setToast(null), 2000);

                // Capture Photo
                const canvas = document.createElement('canvas');
                canvas.width = videoRef.current.videoWidth;
                canvas.height = videoRef.current.videoHeight;
                const ctx = canvas.getContext('2d');

                // Draw and mirror
                ctx.translate(canvas.width, 0);
                ctx.scale(-1, 1);
                ctx.drawImage(videoRef.current, 0, 0);

                const imageSrc = canvas.toDataURL('image/png');

                // Add to photos with random position near center but slightly offset
                const newPhoto = {
                    id: Date.now(),
                    src: imageSrc,
                    x: window.innerWidth / 2 - 160 + (Math.random() * 100 - 50),
                    y: window.innerHeight / 2 - 200 + (Math.random() * 100 - 50)
                };

                setPhotos(prev => [...prev, newPhoto]);
            };

            const deletePhoto = (id) => {
                setPhotos(prev => prev.filter(p => p.id !== id));
            };

            return (
                <div className="w-full h-full relative">
                    {/* Header */}
                    <div className="absolute top-8 left-0 right-0 text-center z-10 pointer-events-none">
                        <h1 className="text-5xl font-bold text-gray-800 drop-shadow-sm tracking-wider">Â∞èÁå™Áõ∏Êú∫</h1>
                        <p className="text-gray-500 mt-2 text-lg">Piggy Camera</p>
                    </div>

                    {/* Instructions */}
                    <div className="fixed bottom-8 right-8 text-right text-gray-400 z-0 pointer-events-none">
                        <p>ÁÇπÂáªÂø´Èó®ÊãçÁÖß</p>
                        <p>ÊãñÊãΩÁÖßÁâáÊï¥ÁêÜ</p>
                        <p>ÊÇ¨ÂÅú‰∏ãËΩΩ/Âà†Èô§</p>
                    </div>

                    {/* Photo Wall (Area for photos) */}
                    <div className="absolute inset-0 z-10 pointer-events-none">
                        <div className="w-full h-full pointer-events-auto">
                            <AnimatePresence>
                                {photos.map(photo => (
                                    <PhotoCard
                                        key={photo.id}
                                        id={photo.id}
                                        imageSrc={photo.src}
                                        initialX={photo.x}
                                        initialY={photo.y}
                                        onDelete={deletePhoto}
                                    />
                                ))}
                            </AnimatePresence>
                        </div>
                    </div>

                    {/* Camera Body */}
                    <CameraBody videoRef={videoRef} onShutter={handleShutter} />

                    {/* Toast Notification */}
                    <AnimatePresence>
                        {toast && (
                            <motion.div
                                initial={{ opacity: 0, y: 20, scale: 0.9 }}
                                animate={{ opacity: 1, y: 0, scale: 1 }}
                                exit={{ opacity: 0, y: -20, scale: 0.9 }}
                                className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white px-8 py-4 rounded-full shadow-2xl z-50 flex items-center gap-3 backdrop-blur-sm"
                            >
                                <span className="text-2xl">üì∏</span>
                                <span className="text-xl font-medium tracking-wide">{toast}</span>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
